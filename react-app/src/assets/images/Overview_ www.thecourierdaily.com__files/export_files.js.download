let NumberYourProcessingFiles=0;let NumberYourCompletedFiles=0;let TimeOutYourProcessingFiles;let PeriodForCheckProcessingFiles=4;function CheckNumberYourProcessingFiles(){$.post("/site-explorer/ajax/get/user-processing-files-number",{},function(response){if(typeof(response.ProcessingCount)!="undefined"&&typeof(response.CompletedCount)!="undefined"){if(NumberYourProcessingFiles>0&&response.ProcessingCount==0&&response.CompletedCount==0){setTimeout(function(){HidePreparingReportExportAlert();},4000);ShowReadyNotification();}
if(response.CompletedCount>NumberYourCompletedFiles){let TimePlus=0;if(PreparingReportExportAlertObj.hasClass("slide-down")){TimePlus=2;}
ShowReadyNotification(TimePlus);DeductNumberYourShownFiles();}
NumberYourCompletedFiles=response.CompletedCount;NumberYourProcessingFiles=response.ProcessingCount;if(NumberYourProcessingFiles>0){$("#top_notifications").removeClass("is-not-empty").addClass("animate");if(TimeOutYourProcessingFiles!=null&&TimeOutYourProcessingFiles!=""){clearTimeout(TimeOutYourProcessingFiles);}
TimeOutYourProcessingFiles=window.setTimeout(CheckNumberYourProcessingFiles,PeriodForCheckProcessingFiles*1000);switch(PeriodForCheckProcessingFiles){case 4:PeriodForCheckProcessingFiles=6;break;case 6:PeriodForCheckProcessingFiles=10;break;case 10:PeriodForCheckProcessingFiles=15;break;case 15:PeriodForCheckProcessingFiles=20;break;}}}},"json");return false;}
function ShowReadyNotification(TimePlus){if(TimePlus==null){TimePlus=0;}else{TimePlus=parseInt(TimePlus);}
$.post("/ajax/user/get/top-notifications/list",{},function(response){fetchTopNotifications(response);if(response.status){let DownloadDesign=false;let DownloadLink="";let DownloadFilename="";let FileSize="";let FileType="";let errorDesign=false;$.each(response.files,function(key,row){if(row.status=="completed"){if(row.filesize!="0"&&row.filesize!=""){if(row.pdf==1){DownloadLink="/site-explorer/pdf-download/"+row.id;}else if(row.xlsx==1){DownloadLink="/site-audit/download/url-details/"+row.id;}else{DownloadLink="/site-explorer/csv-download/"+row.id;}
FileType=row.ext;DownloadFilename=row.filename;DownloadDesign=true;FileSize=row.filesize;}else{DownloadDesign=true;errorDesign=true;}
return false;}});HidePreparingReportExportAlert();if(DownloadDesign){if(!errorDesign){ShowReadyReportExportNotificationWithDownload({DownloadLink:DownloadLink,DownloadFilename:DownloadFilename,FileType:FileType,FileSize:FileSize,TimeToDisplaySec:(12+TimePlus),});}else{ShowErrorExportNotification((12+TimePlus));}}else{ShowReadyCSVExportNotification((2+TimePlus));}
$("#top_notifications").removeClass("animate").addClass("is-not-empty");}},"json");}
function DeductNumberYourShownFiles(){$.post("/site-explorer/ajax/set/deduct-shown-files-number");return false;}
function setNumberOfCompletedExportFiles(){$.post("/site-explorer/ajax/get/user-processing-files-number",{},function(response){NumberYourCompletedFiles=response.CompletedCount;NumberYourProcessingFiles=response.ProcessingCount;if(NumberYourProcessingFiles>0){if(!$('#top_notifications').hasClass('animate')){$('#top_notifications').removeClass('is-not-empty');$('#top_notifications').addClass('animate');CheckNumberYourProcessingFiles();}}else if(NumberYourCompletedFiles>0){if(!$('#top_notifications').hasClass('is-not-empty')){$('#top_notifications').removeClass('animate');$('#top_notifications').addClass('is-not-empty');}}},"json");return false;}
$(document).ready(function(){setNumberOfCompletedExportFiles();});